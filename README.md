# Groq STT PoC

iPhone（WebKit）向けに最適化された「録音→テキスト変換→難語ルビ付け」Webアプリです。

## 機能

1. **リアルタイム文字起こし**: Groq Whisper（whisper-large-v3-turbo）
2. **難語ルビ表示**: Groq LLM（llama-3.1-8b-instant）でCEFR B2+レベルの単語に日本語訳ルビを付与
3. **文字起こし間隔調整**: 2〜6秒から選択可能

## セットアップ

1.  **依存関係のインストール**:
    ```bash
    npm install
    ```

2.  **環境変数の設定**:
    `.env` ファイルを作成し、Groq APIキーを設定してください。
    ```env
    GROQ_API_KEY=gsk_...
    ```

3.  **開発サーバーの起動**:
    ```bash
    npm run dev
    ```

## アーキテクチャ

```
┌─────────────┐     ┌──────────────────┐     ┌─────────────┐
│   Browser   │────▶│ /api/transcribe  │────▶│  Groq STT   │
│  (録音)     │     │   (音声→テキスト)  │     │  (Whisper)  │
└─────────────┘     └──────────────────┘     └─────────────┘
       │                    │
       │                    ▼
       │            ┌──────────────────┐     ┌─────────────┐
       │            │  /api/annotate   │────▶│  Groq LLM   │
       │            │   (難語抽出)      │     │  (Llama)    │
       │            └──────────────────┘     └─────────────┘
       │                    │
       ▼                    ▼
  ┌─────────────────────────────────────┐
  │        UI: テキスト + ルビ表示        │
  └─────────────────────────────────────┘
```

## UI設定

| 設定 | 説明 |
|------|------|
| 文字起こし間隔 | 2〜6秒から選択（短いほどリアルタイム感UP、429リスク増） |
| 難しい単語にルビ表示 | ON/OFFトグル（CEFR B2+の単語に日本語訳ルビ） |

## レート制限対策

1. **候補語フィルタリング**: 7文字未満・一般語を除外してトークン削減
2. **全文1回呼び出し**: 単語ごとにLLMを呼ばず、全文を1回で処理
3. **In-memory lock**: 同時リクエストを1つに制限
4. **キャッシュ**: 同一テキストは10分間キャッシュ

## 技術スタック

- Next.js 15 (App Router)
- Tailwind CSS
- ShadCN/UI
- Groq API (Whisper + Llama)

## 今後の改善案

- [ ] Redis/KVによる分散環境対応
- [ ] WebSocket対応でストリーミング
- [ ] 多言語対応（日本語音声）
- [ ] 設定の永続化（localStorage）
